<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Mã hoá Affine</title>
	<style>
		body {
		  font-size: 16px;
		  margin: 0;
		  padding: 0;
		  font-family: "Consolas", monospace;
		  background: radial-gradient(circle at top, #120022, #000000);
		  color: #e0d7ff;
		}

		/* Thanh tiêu đề */
		#thong-tin {
		  text-align: center;
		  padding: 25px;
		  border-bottom: 1px solid #1a0022;
		  background: linear-gradient(to right, #0a0014, #1a0033);
		  box-shadow: 0 0 25px #a020f0aa, inset 0 0 30px #6a0dad44;
		}
		#thong-tin h1 {
		  color: #bb86fc;
		  letter-spacing: 2px;
		  text-shadow: 0 0 12px #bb86fc, 0 0 25px #9b4dff, 0 0 40px #7a00cc;
		}
		#thong-tin p {
		  color: #aaa;
		  font-style: italic;
		}

		/* Layout 2 cột */
		#chi-tiet {
		  display: flex;
		  min-height: calc(100vh - 120px);
		}
		#chi-tiet > div {
		  width: 50%;
		  padding: 20px;
		  background: rgba(20, 10, 30, 0.92);
		  backdrop-filter: blur(6px);
		  box-shadow: inset 0 0 15px #9b4dff66;
		}
		#ma-hoa {
		  border-right: 1px solid #3a003f;
		}

		/* Tiêu đề nhỏ */
		#chi-tiet h2 {
		  color: #bb86fc;
		  border-bottom: 2px solid #bb86fc;
		  padding-bottom: 8px;
		  text-transform: uppercase;
		  text-shadow: 0 0 10px #bb86fc;
		}
		#chi-tiet h3 {
		  color: #ff79c6;
		  text-shadow: 0 0 8px #ff79c6;
		}

		/* Input + textarea */
		textarea, input {
		  width: 90%;
		  margin: 8px 0;
		  padding: 10px;
		  background: #0b0012;
		  border: 1px solid #4a0066;
		  border-radius: 6px;
		  color: #bb86fc;
		  font-size: 1em;
		  resize: none;
		  outline: none;
		  transition: all 0.3s ease;
		}
		textarea:focus, input:focus {
		  border-color: #ff79c6;
		  box-shadow: 0 0 12px #ff79c6, 0 0 18px #ff1493 inset;
		}

		/* Button */
		button {
		  background: #1a001f;
		  color: #eee;
		  border: 2px solid #ff79c6;
		  padding: 0.6em 1.2em;
		  font-size: 1.1em;
		  cursor: pointer;
		  border-radius: 6px;
		  transition: all 0.3s ease;
		  margin-right: 8px;
		  margin-top: 10px;
		  letter-spacing: 1px;
		}
		button:hover {
		  background: #ff79c6;
		  color: #fff;
		  transform: scale(1.08);
		  box-shadow: 0 0 20px #ff79c6, 0 0 30px #ff1493;
		}

		/* Kết quả */
		#chi-tiet p {
		  color: #eee;
		  font-size: 0.95em;
		  margin: 6px 0;
		  background: rgba(187, 134, 252, 0.07);
		  padding: 6px 10px;
		  border-radius: 4px;
		  white-space: pre-wrap;
		  box-shadow: inset 0 0 10px #9b4dff33;
		}
		.ban-ro-thuc-su, .ma-hoa {
		  color: #8aff80;
		  font-weight: bold;
		  text-shadow: 0 0 6px #80ff80, 0 0 15px #00ff00;
		}
	</style>
</head>
<body>
	<div id="thong-tin">
		<h1>Phương pháp mã hoá Affine</h1>
		<p>Mô tả: Mã hóa Affine là phương pháp thay thế đơn bảng tuyến tính, biến mỗi chữ cái P thành C=(aP+b)mod26 (với gcd(a,26)=1) — đơn giản, trực quan nhưng dễ bị phá bằng phân tích tần suất.</p>
	</div>
	<div id="chi-tiet">
    <div id="ma-hoa">
		<h2>Mã hoá</h2>
		<div>
			<h3>Demo</h3>
			<label>Nhập bản rõ:</label><br>
			<textarea class="ban-ro"></textarea><br>
			<label>Nhập khoá k:</label><br>
			<input class="khoa-k1" type="number" value="3">
			<input class="khoa-k2" type="number" value="8">
		</div>
		<button>Mã hoá</button>
		<div>
			<h3>Results</h3>
			<p class="so-hoa-ban-ro"></p>
			<p class="so-hoa-k"></p>
			<p class="ma-hoa"></p>
		</div>
    </div>
    <div id="giai-ma">
		<h2>Giải mã</h2>
		<div>
			<h3>Demo</h3>
			<label>Nhập bản mã hoá:</label><br>
			<textarea class="ban-ma"></textarea><br>
			<label>Nhập khoá k:</label><br>
			<input class="khoa-k1" type="number" value="3">
			<input class="khoa-k2" type="number" value="8">
		</div>
		<button>Giải mã</button>
		<div>
			<h3>Results</h3>
			<p class="so-hoa-ban-ma"></p>
			<p class="so-hoa-k"></p>
			<p class="ban-ro-thuc-su"></p>
		</div>
		</div>
	</div>

	<script>
		const ma_hoa_btn = document.querySelector('#ma-hoa button')
		const giai_ma_btn = document.querySelector('#giai-ma button')
		const hack_btn = document.querySelector('#giai-ma .hack')

		const bang_ma_anh = "abcdefghiklmnopqrstuvwxyz "
		let so_hoa, result;
		const N = bang_ma_anh.length;
		
		function nguyen_to_cung_nhau(x, y) {
			if(x === undefined || y === undefined || x<0 || y<0) return false;
			var ucln = 1;
			if(x>y) {
				console.log("a không hợp lệ!");
				return false;
			}
			for(let i=1; i<=x; i++){
				if(x%i === 0 && y%i === 0) ucln = i;
			}
			return ucln === 1;
		}

		// ===== Mã hoá =====
		ma_hoa_btn.onclick = function(){
			so_hoa = [], result = [];
			let add_k = [];
			const ban_ro = document.querySelector('#ma-hoa div .ban-ro').value
			const a = parseInt(document.querySelector('#ma-hoa div .khoa-k1').value)
			const b = parseInt(document.querySelector('#ma-hoa div .khoa-k2').value)

			if(nguyen_to_cung_nhau(a,N) === false || ban_ro === '') {
				console.log("a, N không nguyên tố cùng nhau hoặc chưa có bản rõ.")
				return;
			}
			const so_hoa_ban_ro = document.querySelector('#ma-hoa div .so-hoa-ban-ro')
			const so_hoa_k = document.querySelector('#ma-hoa div .so-hoa-k')
			const ma_hoa = document.querySelector('#ma-hoa div .ma-hoa')

			so_hoa_ban_ro.innerHTML = "Số hoá bản rõ: ";
			so_hoa_k.innerHTML = "Số hoá +k: ";
			ma_hoa.innerHTML = "Bản mã ==>";

			for(let i=0; i<ban_ro.length; i++){
				const code = bang_ma_anh.indexOf(ban_ro[i]);
				so_hoa.push(code);
				const shifted = (a*code + b) % N;
				add_k.push(shifted);
				result.push(bang_ma_anh[shifted]);
				so_hoa_ban_ro.innerHTML += " " + code;
				so_hoa_k.innerHTML += " " + shifted;
				ma_hoa.innerHTML += bang_ma_anh[shifted];
			}
		}

		// ===== Giải mã =====
		giai_ma_btn.onclick = function(){
			so_hoa = [], result = [];
			let sub_k = [];
			const ban_ma = document.querySelector('#giai-ma div .ban-ma').value
			const a = parseInt(document.querySelector('#giai-ma div .khoa-k1').value)
			const b = parseInt(document.querySelector('#giai-ma div .khoa-k2').value)
			if(nguyen_to_cung_nhau(a,N) === false || ban_ma === '') {
				console.log("a, N không nguyên tố cùng nhau hoặc chưa có bản mã.")
				return;
			}
			const so_hoa_ban_ma = document.querySelector('#giai-ma div .so-hoa-ban-ma')
			const so_hoa_k = document.querySelector('#giai-ma div .so-hoa-k')
			const ban_ro_thuc_su = document.querySelector('#giai-ma div .ban-ro-thuc-su')

			so_hoa_ban_ma.innerHTML = "Số hoá bản mã: ";
			so_hoa_k.innerHTML = "Số hoá : ";
			ban_ro_thuc_su.innerHTML = "Bản rõ ==>";
			let a_dao;
			
			for(let i=0; i<bang_ma_anh.length; i++){
				if((a*i)%N == 1) a_dao = i;
			}
			console.log(a_dao)

			for(let i=0; i<ban_ma.length; i++){
				const code = bang_ma_anh.indexOf(ban_ma[i]);
				so_hoa.push(code);
				const shifted = a_dao*(code - b % N + N) % N;
				sub_k.push(shifted);
				result.push(bang_ma_anh[shifted]);
				so_hoa_ban_ma.innerHTML += " " + code;
				so_hoa_k.innerHTML += " " + shifted;
				ban_ro_thuc_su.innerHTML += bang_ma_anh[shifted];
			}
		}
	</script>
</body>
</html>
